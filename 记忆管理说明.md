# 记忆管理说明

## 📝 当前默认行为

**默认情况下，每个新任务开始时会清空上一个任务的记忆**。

这是为了：
- ✅ 确保每个任务独立执行，不受之前任务干扰
- ✅ 避免上下文混淆
- ✅ 减少 token 使用（不发送历史对话）
- ✅ 提高执行效率

## 🎯 记忆保留选项

如果你想让 Agent **记住上一个任务**，可以使用 `--keep-memory` 参数：

```bash
python main.py --keep-memory
```

### 使用场景

**保留记忆适合**：
- 📋 处理一系列相关任务
- 🔗 需要基于上一个任务的结果继续工作
- 💬 进行对话式交互
- 📝 编辑和修改同一个项目

**清空记忆适合**（默认）：
- ✅ 执行独立的、不相关的任务
- ✅ 每次任务都是全新的开始
- ✅ 避免混淆和错误
- ✅ 节省 token 使用

## 📊 对比

### 默认模式（清空记忆）

```bash
python main.py

💬 Enter your prompt: 创建一个文件 test.txt
📝 Processing...
✅ 完成

💬 Enter your prompt: 读取这个文件
❌ Agent 不知道 "这个文件" 指的是什么（记忆已清空）
```

### 保留记忆模式

```bash
python main.py --keep-memory

💬 Enter your prompt: 创建一个文件 test.txt
📝 Processing...
✅ 完成

💬 Enter your prompt: 读取这个文件
✅ Agent 知道指的是 test.txt（保留了记忆）
```

## 💡 实际示例

### 示例 1：文件编辑工作流（需要记忆）

```bash
python main.py --keep-memory

💬 任务1: 创建一个 Python 脚本 hello.py，写入 print("Hello")
💬 任务2: 在这个脚本中添加一个函数 greet(name)
💬 任务3: 运行这个脚本
```

**保留记忆的好处**：
- Agent 知道 "这个脚本" 指的是 hello.py
- Agent 知道之前的代码内容
- 可以基于之前的工作继续

### 示例 2：独立任务（不需要记忆）

```bash
python main.py

💬 任务1: 创建一个文件 a.txt
💬 任务2: 搜索 Python 教程
💬 任务3: 创建一个文件 b.txt
```

**清空记忆的好处**：
- 每个任务独立，不会混淆
- 不需要考虑上下文
- 更清晰、更高效

## 🔧 技术细节

### 记忆包含什么？

Agent 的记忆包含：
- 💬 用户的所有请求
- 🤖 Agent 的响应
- 🛠️ 工具调用的结果
- 📝 整个对话历史

### 清空记忆会做什么？

```python
agent.memory = Memory()  # 创建新的空记忆
```

这会：
- 清空所有之前的对话
- 重置到初始状态
- 下一个任务从干净的状态开始

### 保留记忆会做什么？

```python
# 不清空记忆，继续使用当前的 agent.memory
```

这会：
- 保留所有对话历史
- Agent 可以看到之前的任务
- 可以基于上下文理解 "这个"、"那个" 等指代

## ⚠️ 注意事项

### 1. Token 使用

- **保留记忆**：会发送更多历史消息给 LLM，消耗更多 token
- **清空记忆**：每个任务独立，token 使用更少

### 2. 上下文混淆

- **保留记忆**：如果任务不相关，可能产生混淆
- **清空记忆**：每个任务都是独立的，不会混淆

### 3. 性能影响

- **保留记忆**：历史消息增多，可能影响响应速度
- **清空记忆**：每次都是新开始，响应更快

## 🎯 推荐使用方式

### 快速建议

- **处理相关任务**：使用 `--keep-memory`
- **处理独立任务**：使用默认（清空记忆）
- **不确定时**：先试试默认，如果需要上下文再启用记忆

### 命令对比

```bash
# 默认：每个任务独立（推荐用于大多数场景）
python main.py

# 保留记忆：适合连续相关任务
python main.py --keep-memory

# 单次任务（自动清空，因为只运行一次）
python main.py --prompt "你的任务"
```

## 📚 总结

| 模式 | 记忆行为 | 适用场景 |
|------|---------|---------|
| **默认** | 每个任务清空记忆 | 独立任务、节省 token |
| **--keep-memory** | 保留所有对话记忆 | 相关任务、需要上下文 |

根据你的使用场景选择合适的模式！🚀


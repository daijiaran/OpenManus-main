# OpenManus 桌面应用界面设计文档

## 一、项目分析

### 核心功能
基于对 `main.py` 和项目结构的分析，OpenManus 的核心功能包括：

1. **交互式对话模式**：支持连续对话，用户可以输入多个任务
2. **单次任务模式**：执行单个任务后退出
3. **记忆管理**：可选择保持或清除对话历史
4. **异步执行**：基于 asyncio 的异步任务处理
5. **日志输出**：实时显示任务执行状态和结果

### 技术栈
- **后端**：Python 3.12, asyncio, Manus Agent
- **依赖**：OpenAI API, Browser automation, MCP 等

## 二、界面设计方案

### 技术选型
**推荐使用 PyQt6** 作为桌面应用框架，理由如下：
- 跨平台支持（Windows, macOS, Linux）
- 现代化的 UI 组件
- 良好的异步支持（QThread, asyncio 集成）
- 丰富的文档和社区支持
- 专业的外观和用户体验

### 界面布局

#### 主窗口结构
```
┌─────────────────────────────────────────────────────────┐
│  OpenManus - AI Agent Desktop                    [_][□][×]│
├─────────────────────────────────────────────────────────┤
│  [配置] [历史] [关于]                                      │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌───────────────────────────────────────────────────┐ │
│  │  对话历史区域                                       │ │
│  │  ┌─────────────────────────────────────────────┐  │ │
│  │  │ 👤 用户: 帮我分析一下这个数据集                │  │ │
│  │  └─────────────────────────────────────────────┘  │ │
│  │  ┌─────────────────────────────────────────────┐  │ │
│  │  │ 🤖 Manus: 好的，我来帮你分析...              │  │ │
│  │  │   [执行中] 正在读取数据...                   │  │ │
│  │  └─────────────────────────────────────────────┘  │ │
│  │                                                   │ │
│  └───────────────────────────────────────────────────┘ │
│                                                         │
│  ┌───────────────────────────────────────────────────┐ │
│  │ 输入您的任务...                                    │ │
│  └───────────────────────────────────────────────────┘ │
│  [发送] [停止] [清空对话]  ☑ 保持记忆                   │
│                                                         │
│  状态: 就绪 | 步骤: 0/0 | 模型: gpt-4o                   │
└─────────────────────────────────────────────────────────┘
```

### 功能模块

#### 1. 主对话区域
- **对话历史显示**：滚动文本区域，支持富文本格式
- **消息类型区分**：
  - 用户消息（蓝色背景）
  - Agent 响应（灰色背景）
  - 系统日志（绿色文本）
  - 错误信息（红色文本）
- **实时更新**：Agent 执行过程中实时显示日志

#### 2. 输入控制区域
- **多行文本输入框**：支持换行输入复杂任务
- **发送按钮**：提交任务
- **停止按钮**：中断当前执行的任务
- **清空对话按钮**：清除对话历史
- **保持记忆复选框**：控制是否保留对话上下文

#### 3. 状态栏
- **运行状态**：就绪/执行中/已完成/错误
- **执行步骤**：当前步骤/总步骤
- **模型信息**：当前使用的 LLM 模型

#### 4. 菜单栏
- **配置菜单**：
  - LLM 配置（API Key, 模型选择, 温度等）
  - 代理设置
  - 日志级别
- **历史菜单**：
  - 查看历史对话
  - 导出对话记录
  - 清除历史
- **关于菜单**：
  - 版本信息
  - 项目链接
  - 许可证

## 三、技术实现要点

### 1. 异步集成
- 使用 `qasync` 库集成 PyQt6 和 asyncio
- 在 Qt 事件循环中运行 Manus Agent

### 2. 线程安全
- Agent 执行在独立线程中
- 使用信号槽机制更新 UI

### 3. 日志捕获
- 重定向 loguru 输出到 GUI
- 实时显示执行日志

### 4. 配置管理
- 图形化编辑 config.toml
- 验证配置有效性

### 5. 错误处理
- 友好的错误提示
- 异常捕获和恢复机制

## 四、开发计划

### Phase 1: 基础框架
- 创建主窗口和基本布局
- 实现消息显示区域
- 实现输入控制区域

### Phase 2: Agent 集成
- 集成 Manus Agent
- 实现异步任务执行
- 实现日志捕获和显示

### Phase 3: 高级功能
- 配置管理界面
- 历史记录管理
- 导出功能

### Phase 4: 优化和测试
- UI 美化
- 性能优化
- 功能测试
